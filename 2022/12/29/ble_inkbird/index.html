<!doctype html><html lang=ja-jp><head><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Windows10からINKBIRD温度湿度計データをBLE通信で取得する","image":"https://aktnk.github.io/images/ble_inkbird/cover.png","datePublished":"2022-12-29T20:17:55+09:00","dateModified":"2022-12-29T20:17:55+09:00","author":{"@type":"Person","name":null,"image":"https://avatars.githubusercontent.com/u/13390370?v=4"},"mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/aktnk.github.io\/2022\/12\/29\/ble_inkbird\/"},"publisher":{"@type":"Organization","name":"Aktnk Lab","logo":{"@type":"ImageObject","url":"https://avatars.githubusercontent.com/u/13390370?v=4"}},"description":"目次 はじめに 使用した機器 購入したもの PC スマホ 準備 Python 仮想環境の構築 INKBIRD 温度湿度計を稼働させる INKBIRD 温湿度計の Bluetooth 通信内容調査 MAC アドレス調査 データ取得用","keywords":[]}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.96.0 with theme Tranquilpeak 0.5.3-BETA"><meta name=author content><meta name=keywords content><meta name=description content="目次 はじめに 使用した機器 購入したもの PC スマホ 準備 Python 仮想環境の構築 INKBIRD 温度湿度計を稼働させる INKBIRD 温湿度計の Bluetooth 通信内容調査 MAC アドレス調査 データ取得用"><meta property="og:description" content="目次 はじめに 使用した機器 購入したもの PC スマホ 準備 Python 仮想環境の構築 INKBIRD 温度湿度計を稼働させる INKBIRD 温湿度計の Bluetooth 通信内容調査 MAC アドレス調査 データ取得用"><meta property="og:type" content="article"><meta property="og:title" content="Windows10からINKBIRD温度湿度計データをBLE通信で取得する"><meta name=twitter:title content="Windows10からINKBIRD温度湿度計データをBLE通信で取得する"><meta property="og:url" content="https://aktnk.github.io/2022/12/29/ble_inkbird/"><meta property="twitter:url" content="https://aktnk.github.io/2022/12/29/ble_inkbird/"><meta property="og:site_name" content="Aktnk Lab"><meta property="og:description" content="目次 はじめに 使用した機器 購入したもの PC スマホ 準備 Python 仮想環境の構築 INKBIRD 温度湿度計を稼働させる INKBIRD 温湿度計の Bluetooth 通信内容調査 MAC アドレス調査 データ取得用"><meta name=twitter:description content="目次 はじめに 使用した機器 購入したもの PC スマホ 準備 Python 仮想環境の構築 INKBIRD 温度湿度計を稼働させる INKBIRD 温湿度計の Bluetooth 通信内容調査 MAC アドレス調査 データ取得用"><meta property="og:locale" content="ja"><meta property="article:published_time" content="2022-12-29T20:17:55"><meta property="article:modified_time" content="2022-12-29T20:17:55"><meta property="article:section" content="IoT"><meta property="article:tag" content="INKBIRD"><meta property="article:tag" content="ITH-12S"><meta property="article:tag" content="IBS-TH2"><meta property="article:tag" content="Bluetooth LE"><meta name=twitter:card content="summary"><meta name=twitter:site content="@ak_tnk3"><meta name=twitter:creator content="@ak_tnk3"><meta property="fb:admins" content="1378464508"><meta property="og:image" content="https://avatars.githubusercontent.com/u/13390370?v=4"><meta property="twitter:image" content="https://avatars.githubusercontent.com/u/13390370?v=4"><meta property="og:image" content="https://aktnk.github.io/images/ble_inkbird/cover.png"><meta property="twitter:image" content="https://aktnk.github.io/images/ble_inkbird/cover.png"><title>Windows10からINKBIRD温度湿度計データをBLE通信で取得する</title><link rel=icon href=/favicon.png><link rel=canonical href=https://aktnk.github.io/2022/12/29/ble_inkbird/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://aktnk.github.io/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-5618431-10","auto"),ga("send","pageview"))</script></head><body><div id=blog><header id=header data-behavior=4><i id=btn-open-sidebar class="fa fa-lg fa-bars"></i><div class=header-title><a class=header-title-link href=/ aria-label=ホームページへ>Aktnk Lab</a></div><a class=header-right-picture href=/#about aria-label="リンクを開く: /#about"><img class=header-picture src="https://avatars.githubusercontent.com/u/13390370?v=4" alt=プロフィール画像></a></header><nav id=sidebar data-behavior=4><div class=sidebar-container><div class=sidebar-profile><a href=/#about aria-label=著者についてもっと読む><img class=sidebar-profile-picture src="https://avatars.githubusercontent.com/u/13390370?v=4" alt=プロフィール画像></a><h4 class=sidebar-profile-name></h4><h5 class=sidebar-profile-bio>Aktnk Lab is my personal blog.</h5></div><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=/ title=Home><i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden=true></i>
<span class=sidebar-button-desc>ホーム</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/categories title=Categories><i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden=true></i>
<span class=sidebar-button-desc>カテゴリー</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/tags title=Tags><i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden=true></i>
<span class=sidebar-button-desc>タグ</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/archives title=Archives><i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden=true></i>
<span class=sidebar-button-desc>アーカイブ</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/#about title=About><i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden=true></i>
<span class=sidebar-button-desc>About</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://github.com/aktnk target=_blank rel=noopener title=GitHub><i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden=true></i>
<span class=sidebar-button-desc>GitHub</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=/index.xml title=RSS><i class="sidebar-button-icon fas fa-lg fa-rss" aria-hidden=true></i>
<span class=sidebar-button-desc>RSS</span></a></li></ul></div></nav><div id=main data-behavior=4 class=hasCoverMetaIn><article class=post id=top><div class="post-header main-content-wrap text-left"><h1 class=post-title>Windows10からINKBIRD温度湿度計データをBLE通信で取得する</h1><div class="postShorten-meta post-meta"><time datetime=2022-12-29T20:17:55+09:00>12 29, 2022</time>
<span>カテゴリー</span>
<a class=category-link href=/categories/iot>IoT</a></div></div><div class="post-content markdown"><div class=main-content-wrap><h1 id=table-of-contents>目次</h1><nav id=TableOfContents><ul><li><a href=#はじめに>はじめに</a></li><li><a href=#使用した機器>使用した機器</a><ul><li><a href=#購入したもの>購入したもの</a></li><li><a href=#pc>PC</a></li><li><a href=#スマホ>スマホ</a></li></ul></li><li><a href=#準備>準備</a><ul><li><a href=#python-仮想環境の構築>Python 仮想環境の構築</a></li><li><a href=#inkbird-温度湿度計を稼働させる>INKBIRD 温度湿度計を稼働させる</a></li><li><a href=#inkbird-温湿度計の-bluetooth-通信内容調査>INKBIRD 温湿度計の Bluetooth 通信内容調査</a><ul><li><a href=#mac-アドレス調査>MAC アドレス調査</a></li><li><a href=#データ取得用-uuid-調査>データ取得用 UUID 調査</a></li></ul></li><li><a href=#温度湿度データ取得のトライ>温度湿度データ取得のトライ</a><ul><li><a href=#トライ用に作成した-python-スクリプト>トライ用に作成した Python スクリプト</a></li><li><a href=#実行結果>実行結果</a></li></ul></li></ul></li><li><a href=#最後に>最後に</a></li></ul></nav><h1 id=はじめに>はじめに</h1><p>今回は Bluetooth 機能がついた温度・湿度計を Bluetooth 経由で PC と接続し、温度・湿度データを取得します。</p><p>これまで Bluetooth と言えば、iPhone を車載オーディオに接続し音楽を聞いたり、ワイヤレスヘッドフォンをノート PC と接続したり・・・、音楽用に使うイメージしかありませんでした。
いつものように Amazon のサイトを見ていると、INKBIRD という会社から Bluetooth 通信機能がついた温度・湿度計が発売されていることに気付きました。</p><p>そこで、Windows10 のノート PC の Bluetooth を使い、INKBIRD 温度・湿度計から温度・湿度データを取得してみます。</p><h1 id=使用した機器>使用した機器</h1><h2 id=購入したもの>購入したもの</h2><ul><li>INKBIRD の Bluetooth 温度湿度計（2 機種）<figure><img src=/images/ble_inkbird/inkbird_sensors.png alt=INKBIRDのBluetooth温度湿度計 height=350><figcaption><p>INKBIRDのBluetooth温度湿度計</p></figcaption></figure><ul><li>IBS-TH2 <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> + 単 4 電池 2 本<figure><img src=/images/ble_inkbird/IBSTH2.jpg alt=IBS-TH2 height=300><figcaption><p>IBS-TH2</p></figcaption></figure></li><li>ITH-12S（Bluetooth 温度湿度計）<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup><figure><img src=/images/ble_inkbird/ITH12S.jpg alt=ITH-12S height=150><figcaption><p>ITH-12S</p></figcaption></figure></li></ul></li></ul><h2 id=pc>PC</h2><ul><li>Blutooth が使用可能な PC<br>事前に[Windows スタート]>[設定]>[デバイス]から Bliutooth を有効にしておきましょう。<figure><img src=/images/ble_inkbird/win10_ble_settings.png alt="Windows10 Bluetoothの有効化" height=400><figcaption><p>Windows10 Bluetoothの有効化</p></figcaption></figure>なお、今回使用した PC は<ul><li>ASUS UX310U NotebookPC<br>CPU: Intel(R) Core(TM) i5-7200U CPU @ 2.50GHz 2.71 GHz<br>OS: WIndows 10 Pro 22H2<br>です。</li></ul></li></ul><h2 id=スマホ>スマホ</h2><ul><li>Android もしくは iPhone + nRF Connect for Mobile アプリ<br>事前に Nordic Semiconductor 社の<a href=https://www.nordicsemi.com/Products/Development-tools/nrf-connect-for-mobile>nRF Connect for Mobile https://www.nordicsemi.com/Products/Development-tools/nrf-connect-for-mobile</a>をインストールしておきましょう。</li></ul><h1 id=準備>準備</h1><h2 id=python-仮想環境の構築>Python 仮想環境の構築</h2><p>Windows10 上にインストールした python3.8 を使い、仮想環境を作成し、bleak パッケージ <a href=https://pypi.org/project/bleak/>https://pypi.org/project/bleak/</a> をインストールします。なお、私がインストールした bleak のバージョンは 0.19.5 でした。</p><pre tabindex=0><code>PS D:\projects\ble&gt; python -m venv venv38

PS D:\projects\ble&gt; .\venv38\Script\activate

(vnev28) PS D:\projects\ble&gt; pip install bleak
省略
(venv38) PS D:\projects\ble&gt; pip show bleak
Name: bleak
Version: 0.19.5
Summary: Bluetooth Low Energy platform Agnostic Klient
Home-page: https://github.com/hbldh/bleak
Author: Henrik Blidh
Author-email: henrik.blidh@nedomkull.com
License: MIT
Location: d:\projects\ble\venv38\lib\site-packages
Requires: async-timeout, bleak-winrt
Required-by:
(venv38) PS D:\projects\ble&gt;
</code></pre><h2 id=inkbird-温度湿度計を稼働させる>INKBIRD 温度湿度計を稼働させる</h2><p>Amazon から INKBIRD の温度湿度計が届いたら、電池を入れて稼働させます。</p><ul><li>ITH-12S はボタン電池 CR2032 が付属していますので、上下（＋－）を間違えないように取り付けます。<figure><img src=/images/ble_inkbird/ITH12S_battery.jpg alt=ITH-12Sバッテリ取付 height=150><figcaption><p>ITH-12Sバッテリ取付</p></figcaption></figure>なお、電池を取り付けたらパネル右上の Bluetooth 通信が ON になっていることを確認します。もし ON になっていない場合は、Bluetooth のボタンを何度か押して ON にします。<figure><img src=/images/ble_inkbird/ITH12S_ble.jpg alt="ITH-12S Bleutooth通信ON" height=250><figcaption><p>ITH-12S Bleutooth通信ON</p></figcaption></figure></li><li>IBS-TH2 は単 4 電池が 2 本必要です。付属のドライバーを使い、IBS-TH2 の裏蓋を開け単 4 電池を装着します。<figure><img src=/images/ble_inkbird/IBSTH2_battery.jpg alt=IBS-TH2バッテリ取付 height=300><figcaption><p>IBS-TH2バッテリ取付</p></figcaption></figure></li></ul><h2 id=inkbird-温湿度計の-bluetooth-通信内容調査>INKBIRD 温湿度計の Bluetooth 通信内容調査</h2><h3 id=mac-アドレス調査>MAC アドレス調査</h3><p>Android または iPhone にインストールした nRF Connect を起動し、バッテリを入れた温度湿度計の MAC アドレスを確認します。下図の sps と表示されている欄に記載されている"49:22:**:**:**:**&ldquo;の 16 進の数値が MAC アドレスです。このように 2 つ同時に稼働させると 2 つのどちら INKBIRD の MAC アドレスかわかりませんので、ITH-12S は Bluetooth 通信をボタンで OFF にし、MAC アドレスを確認します。<figure><img src=/images/ble_inkbird/mac_address.png alt="nRF ConnectでMACアドレス確認" height=600><figcaption><p>nRF ConnectでMACアドレス確認</p></figcaption></figure></p><h3 id=データ取得用-uuid-調査>データ取得用 UUID 調査</h3><ul><li><p>UUID 共通部分の調査</p><ul><li>nRF Connect に表示された sps をクリックし、情報を表示させます。そして、[MORE]のリンクをクリックします。<figure><img src=/images/ble_inkbird/more.png alt="nRF ConnectでUUIDの調査(1)" height=600><figcaption><p>nRF ConnectでUUIDの調査(1)</p></figcaption></figure></li><li>表示された画面にて[FLAGS & SERVICES]タブをクリックし、サービスクラス UUID を確認します。ここには 3 つ UUID が表示されており、下記全てが共通していることがわかります。<br><code>0000fff0-0000-1000-8000-00805f9b34fb</code><figure><img src=/images/ble_inkbird/uuid.png alt="nRF ConnectでUUIDの調査(2)" height=600><figcaption><p>nRF ConnectでUUIDの調査(2)</p></figcaption></figure></li></ul></li><li><p>温度・湿度データ取得用コードの調査</p><ul><li>元も表示に戻り、今度は[CONNECT]ボタンを押します。<figure><img src=/images/ble_inkbird/connect.png alt="nRF Connectでデータ取得コードの調査(1)" height=600><figcaption><p>nRF Connectでデータ取得コードの調査(1)</p></figcaption></figure></li><li>表示された画面にて[Unknown Service]をクリックします。<figure><img src=/images/ble_inkbird/service.png alt="nRF Connectでデータ取得コードの調査(2)" height=600><figcaption><p>nRF Connectでデータ取得コードの調査(2)</p></figcaption></figure></li><li>表示された画面にて上から順に、ダウンロードボタンをクリックし、Unknouwn Characteristic の内容、Characterristic User Descrption の内容を取得し、表示させます。すると、Realtime data 取得コードが UUID 0xFFF2 だと推察できます。<figure><img src=/images/ble_inkbird/realtimedata.png alt="nRF Connectでデータ取得コードの調査(3)" height=600><figcaption><p>nRF Connectでデータ取得コードの調査(3)</p></figcaption></figure></li></ul></li></ul><h2 id=温度湿度データ取得のトライ>温度湿度データ取得のトライ</h2><p><a href=https://github.com/hbldh/bleak>GitHub の bleak リポジトリ https://github.com/hbldh/bleak</a>に<a href=https://github.com/hbldh/bleak/tree/develop/examples>実装例 https://github.com/hbldh/bleak/tree/develop/examples</a>が公開されています。
これらを参考にしながら、前節で調査した MAC アドレスおよび UUID 共通部分の先頭4バイトをデータ取得用 UUID に置き換えて、温度・湿度データの取得できるかトライします。</p><h3 id=トライ用に作成した-python-スクリプト>トライ用に作成した Python スクリプト</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PYTHON data-lang=PYTHON><span style=display:flex><span><span style=color:#f92672>import</span> asyncio
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bleak <span style=color:#f92672>import</span> BleakClient
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> struct
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MACS <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;49:22:03:25:03:ED&#34;</span>,<span style=color:#e6db74>&#34;49:22:08:15:10:2B&#34;</span>]
</span></span><span style=display:flex><span>REALTIME_DATA_UUID <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0000fff2-0000-1000-8000-00805f9b34fb&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>run</span>(address, loop):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>with</span> BleakClient(address, loop<span style=color:#f92672>=</span>loop) <span style=color:#66d9ef>as</span> client:
</span></span><span style=display:flex><span>    x <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> client<span style=color:#f92672>.</span>is_connected()
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Connected: </span><span style=color:#e6db74>{0}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(x))
</span></span><span style=display:flex><span>    y <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> client<span style=color:#f92672>.</span>read_gatt_char(REALTIME_DATA_UUID)
</span></span><span style=display:flex><span>    print(y)
</span></span><span style=display:flex><span>    (temp, humid, unknown)<span style=color:#f92672>=</span>real_time_data(y)
</span></span><span style=display:flex><span>    print(temp)
</span></span><span style=display:flex><span>    print(humid)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>unknown<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>real_time_data</span>(y):
</span></span><span style=display:flex><span>    (a, b, c, d, e) <span style=color:#f92672>=</span> struct<span style=color:#f92672>.</span>unpack(<span style=color:#e6db74>&#39;&lt;HHBBB&#39;</span>, y)
</span></span><span style=display:flex><span>    temp <span style=color:#f92672>=</span> a<span style=color:#f92672>/</span><span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>    humid <span style=color:#f92672>=</span> b<span style=color:#f92672>/</span><span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>    unknown <span style=color:#f92672>=</span> ( c, d, e )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> temp, humid, unknown
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name___<span style=color:#f92672>==</span><span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    loop <span style=color:#f92672>=</span> asyncio<span style=color:#f92672>.</span>get_event_loop()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> address <span style=color:#f92672>in</span> MACS:
</span></span><span style=display:flex><span>        loop<span style=color:#f92672>.</span>run_until_complete(run(address, loop))</span></span></code></pre></td></tr></table></div></div><h3 id=実行結果>実行結果</h3><p>実行すると、下記のように2つのINKBIRDから温度・湿度が取得できました。</p><pre tabindex=0><code>(venv38) PS D:\projects\ble&gt; python .\test1.py
.\test1.py:10: FutureWarning: is_connected has been changed to a property. Calling it as an async method will be removed in a future version
x = await client.is_connected()
Connected: True
bytearray(b&#39;\x0f\t\xb5\x15\x00l\xeb&#39;)
23.19
55.57
(0, 108, 235)
Connected: True
bytearray(b&#39;\x84\x08j\x17\x00\xf9\x92&#39;)
21.8
59.94
(0, 249, 146)
(venv38) PS D:\projects\ble&gt;
</code></pre><h1 id=最後に>最後に</h1><p>Google で inkbird pythonと検索すると、INS-TH1の温度湿度データをLinuxのbluepyを使って取得記事がいくつか出てきます。</p><ul><li><a href=https://qiita.com/c60evaporator/items/e7c3b2c65ad1664c832f>https://qiita.com/c60evaporator/items/e7c3b2c65ad1664c832f</a></li><li><a href=https://qiita.com/junara/items/f396c1c4c15c78cde89f>https://qiita.com/junara/items/f396c1c4c15c78cde89f</a></li><li><a href=https://zenn.dev/yh1224/articles/ld2arlkd2v6azz4xg>https://zenn.dev/yh1224/articles/ld2arlkd2v6azz4xg</a></li></ul><p>今回はこれらを参考にWindows10でbluepyを試しましたが、そもそもbluepyがインストールすることができませんでした。</p><p>そんな中で見つけたのが、下記の記事でした。</p><ul><li><a href=https://atatat.hatenablog.com/entry/2020/07/09/003000>https://atatat.hatenablog.com/entry/2020/07/09/003000</a></li></ul><p>ここではWindows10でbleakを使い、BLE通信でデータを取得する方法が記載されていました。今回のBLE通信の部分は全く同じものです。</p><p>その際に苦労したのは、実測データを取得するためのUUIDを調べることでした。
この記事にはあっさりと書いていますが、実際には上から順に全て試しながら調べた結果です。</p><p>しかしながら、この記事を書きながら再度Google検索をしていたところ、なっなんとINKBIRDのアドバタイズパケットに温度・湿度データの他にもバッテリーレベルを取得している実装<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>がGitHub上の<a href=https://github.com/custom-components/ble_monitor>CUSTOM_COMPONENTS/BLE Monitorのリポジトリhttps://github.com/custom-components/ble_monitor</a>にて公開されていることがわかりました。</p><p>ここまで書いてから見つけてしまったので、この記事はそのまま公開します。</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>購入先 Amazon <a href=https://www.amazon.co.jp/gp/product/B08WWPSTRS>https://www.amazon.co.jp/gp/product/B08WWPSTRS</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>購入先 Amazon <a href=https://www.amazon.co.jp/gp/product/B09PDMH3FQ>https://www.amazon.co.jp/gp/product/B09PDMH3FQ</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>アドバタイズパケットから温度湿度等を取得する実装は下記公開されています。<a href=https://github.com/custom-components/ble_monitor/blob/master/custom_components/ble_monitor/ble_parser/inkbird.py>https://github.com/custom-components/ble_monitor/blob/master/custom_components/ble_monitor/ble_parser/inkbird.py</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></div><div id=post-footer class="post-footer main-content-wrap"><div class=post-footer-tags><span class="text-color-light text-small">タグ</span><br><a class="tag tag--primary tag--small" href=/tags/inkbird/>INKBIRD</a>
<a class="tag tag--primary tag--small" href=/tags/ith-12s/>ITH-12S</a>
<a class="tag tag--primary tag--small" href=/tags/ibs-th2/>IBS-TH2</a>
<a class="tag tag--primary tag--small" href=/tags/bluetooth-le/>Bluetooth LE</a></div><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--disabled"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">次</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2022/07/04/povo2_0/ data-tooltip=KYF38のかけ放題をauからpovo2.0に変更し、月3575円から月1650円に aria-label="前: KYF38のかけ放題をauからpovo2.0に変更し、月3575円から月1650円に"><span class="hide-xs hide-sm text-small icon-mr">前</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label=この記事を共有する><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://aktnk.github.io/2022/12/29/ble_inkbird/" title=Facebookで共有 aria-label=Facebookで共有><i class="fab fa-facebook-square" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://aktnk.github.io/2022/12/29/ble_inkbird/" title=Twitterで共有 aria-label=Twitterで共有><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://aktnk.github.io/2022/12/29/ble_inkbird/" title=Linkedinで共有 aria-label=Linkedinで共有><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label=トップに戻る><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div></div></article><footer id=footer class=main-content-wrap><span class=copyrights>&copy; 2022 Aktnk Lab. All Rights Reserved</span></footer></div><div id=bottom-bar class=post-bottom-bar data-behavior=4><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--disabled"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">次</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2022/07/04/povo2_0/ data-tooltip=KYF38のかけ放題をauからpovo2.0に変更し、月3575円から月1650円に aria-label="前: KYF38のかけ放題をauからpovo2.0に変更し、月3575円から月1650円に"><span class="hide-xs hide-sm text-small icon-mr">前</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label=この記事を共有する><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://aktnk.github.io/2022/12/29/ble_inkbird/" title=Facebookで共有 aria-label=Facebookで共有><i class="fab fa-facebook-square" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://aktnk.github.io/2022/12/29/ble_inkbird/" title=Twitterで共有 aria-label=Twitterで共有><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://aktnk.github.io/2022/12/29/ble_inkbird/" title=Linkedinで共有 aria-label=Linkedinで共有><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label=トップに戻る><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div></div><div id=share-options-bar class=share-options-bar data-behavior=4><i id=btn-close-shareoptions class="fa fa-times"></i><ul class=share-options><li class=share-option><a class=share-option-btn target=new href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Faktnk.github.io%2F2022%2F12%2F29%2Fble_inkbird%2F" aria-label=Facebookで共有><i class="fab fa-facebook-square" aria-hidden=true></i><span>Facebookで共有</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://twitter.com/intent/tweet?text=https%3A%2F%2Faktnk.github.io%2F2022%2F12%2F29%2Fble_inkbird%2F" aria-label=Twitterで共有><i class="fab fa-twitter" aria-hidden=true></i><span>Twitterで共有</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Faktnk.github.io%2F2022%2F12%2F29%2Fble_inkbird%2F" aria-label=Linkedinで共有><i class="fab fa-linkedin" aria-hidden=true></i><span>Linkedinで共有</span></a></li></ul></div><div id=share-options-mask class=share-options-mask></div></div><div id=about><div id=about-card><div id=about-btn-close><i class="fa fa-times"></i></div><img id=about-card-picture src="https://avatars.githubusercontent.com/u/13390370?v=4" alt=プロフィール画像><h4 id=about-card-name></h4><div id=about-card-bio>Aktnk Lab is my personal blog.</div><div id=about-card-job><i class="fa fa-briefcase"></i><br>in-house system engineer</div><div id=about-card-location><i class="fa fa-map-marker-alt"></i><br>Shizuoka pref. in Japan</div></div></div><div id=cover style=background-image:url(https://aktnk.github.io/images/metro_filt.jpg)></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://aktnk.github.io/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js></script>
<script>$(document).ready(function(){hljs.configure({classPrefix:'',useBR:!1}),$("pre.code-highlight > code, pre > code").each(function(t,e){$(this).hasClass("codeblock")||$(this).addClass("codeblock"),hljs.highlightBlock(e)})})</script></body></html>