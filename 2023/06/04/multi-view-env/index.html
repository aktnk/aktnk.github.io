<!doctype html><html lang=ja-jp><head><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Photogrammetry - MVE","image":"https://aktnk.github.io/images/multi_view_env/result_ply.png","datePublished":"2023-06-04T15:10:14+09:00","dateModified":"2023-06-04T15:10:14+09:00","author":{"@type":"Person","name":null,"image":"https://avatars.githubusercontent.com/u/13390370?v=4"},"mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/aktnk.github.io\/2023\/06\/04\/multi-view-env\/"},"publisher":{"@type":"Organization","name":"Aktnk Lab","logo":{"@type":"ImageObject","url":"https://avatars.githubusercontent.com/u/13390370?v=4"}},"description":"目次 はじめに Photogrammetryとは Multi-View Environment 写真の準備 Reconstrction Pipelineの実行 生成された3Dデータの確認 他にも写真を取り実行してみた\u0026h","keywords":[]}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.96.0 with theme Tranquilpeak 0.5.3-BETA"><meta name=author content><meta name=keywords content><meta name=description content="目次 はじめに Photogrammetryとは Multi-View Environment 写真の準備 Reconstrction Pipelineの実行 生成された3Dデータの確認 他にも写真を取り実行してみた&h"><meta property="og:description" content="目次 はじめに Photogrammetryとは Multi-View Environment 写真の準備 Reconstrction Pipelineの実行 生成された3Dデータの確認 他にも写真を取り実行してみた&h"><meta property="og:type" content="article"><meta property="og:title" content="Photogrammetry - MVE"><meta name=twitter:title content="Photogrammetry - MVE"><meta property="og:url" content="https://aktnk.github.io/2023/06/04/multi-view-env/"><meta property="twitter:url" content="https://aktnk.github.io/2023/06/04/multi-view-env/"><meta property="og:site_name" content="Aktnk Lab"><meta property="og:description" content="目次 はじめに Photogrammetryとは Multi-View Environment 写真の準備 Reconstrction Pipelineの実行 生成された3Dデータの確認 他にも写真を取り実行してみた&h"><meta name=twitter:description content="目次 はじめに Photogrammetryとは Multi-View Environment 写真の準備 Reconstrction Pipelineの実行 生成された3Dデータの確認 他にも写真を取り実行してみた&h"><meta property="og:locale" content="ja"><meta property="article:published_time" content="2023-06-04T15:10:14"><meta property="article:modified_time" content="2023-06-04T15:10:14"><meta property="article:section" content="Photogrammetry"><meta property="article:tag" content="Multi-View Environment"><meta property="article:tag" content="Photogrammetry"><meta property="article:tag" content="Docker"><meta name=twitter:card content="summary"><meta name=twitter:site content="@ak_tnk3"><meta name=twitter:creator content="@ak_tnk3"><meta property="fb:admins" content="1378464508"><meta property="og:image" content="https://avatars.githubusercontent.com/u/13390370?v=4"><meta property="twitter:image" content="https://avatars.githubusercontent.com/u/13390370?v=4"><meta property="og:image" content="https://aktnk.github.io/images/multi_view_env/result_ply.png"><meta property="twitter:image" content="https://aktnk.github.io/images/multi_view_env/result_ply.png"><title>Photogrammetry - MVE</title><link rel=icon href=/favicon.png><link rel=canonical href=https://aktnk.github.io/2023/06/04/multi-view-env/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://aktnk.github.io/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css><link rel=stylesheet href=https://aktnk.github.io/css/custom.css><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-5618431-10","auto"),ga("send","pageview"))</script></head><body><div id=blog><header id=header data-behavior=4><i id=btn-open-sidebar class="fa fa-lg fa-bars"></i><div class=header-title><a class=header-title-link href=/ aria-label=ホームページへ>Aktnk Lab</a></div><a class=header-right-picture href=/#about aria-label="リンクを開く: /#about"><img class=header-picture src="https://avatars.githubusercontent.com/u/13390370?v=4" alt=プロフィール画像></a></header><nav id=sidebar data-behavior=4><div class=sidebar-container><div class=sidebar-profile><a href=/#about aria-label=著者についてもっと読む><img class=sidebar-profile-picture src="https://avatars.githubusercontent.com/u/13390370?v=4" alt=プロフィール画像></a><h4 class=sidebar-profile-name></h4><h5 class=sidebar-profile-bio>Aktnk Lab is my personal blog.</h5></div><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=/ title=Home><i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden=true></i>
<span class=sidebar-button-desc>ホーム</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/categories title=Categories><i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden=true></i>
<span class=sidebar-button-desc>カテゴリー</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/tags title=Tags><i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden=true></i>
<span class=sidebar-button-desc>タグ</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/archives title=Archives><i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden=true></i>
<span class=sidebar-button-desc>アーカイブ</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/#about title=About><i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden=true></i>
<span class=sidebar-button-desc>About</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://github.com/aktnk target=_blank rel=noopener title=GitHub><i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden=true></i>
<span class=sidebar-button-desc>GitHub</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=/index.xml title=RSS><i class="sidebar-button-icon fas fa-lg fa-rss" aria-hidden=true></i>
<span class=sidebar-button-desc>RSS</span></a></li></ul></div></nav><div id=main data-behavior=4 class=hasCoverMetaIn><article class=post id=top><div class="post-header main-content-wrap text-left"><h1 class=post-title>Photogrammetry - MVE</h1><div class="postShorten-meta post-meta"><time datetime=2023-06-04T15:10:14+09:00>6 4, 2023</time>
<span>カテゴリー</span>
<a class=category-link href=/categories/photogrammetry>Photogrammetry</a></div></div><div class="post-content markdown"><div class=main-content-wrap><h1 id=table-of-contents>目次</h1><nav id=TableOfContents><ul><li><a href=#はじめに>はじめに</a><ul><li><a href=#photogrammetryとは>Photogrammetryとは</a></li></ul></li><li><a href=#multi-view-environment>Multi-View Environment</a><ul><li><a href=#写真の準備>写真の準備</a></li><li><a href=#reconstrction-pipelineの実行>Reconstrction Pipelineの実行</a></li><li><a href=#生成された3dデータの確認>生成された3Dデータの確認</a></li><li><a href=#他にも写真を取り実行してみた>他にも写真を取り実行してみた&mldr;</a></li></ul></li></ul></nav><h1 id=はじめに>はじめに</h1><p>今頃？　と思うかもしれませんが、最近 Photogrammetry に興味を持ちました。<br>今回は、iPhoneやデジカメのカメラを使って撮影した画像から、PLYファイルなどの3次元データを取得するOSSである<a href=https://github.com/simonfuhrmann/mve>Multi-View Environment &ldquo;https://github.com/simonfuhrmann/mve&rdquo;</a>を試してみようと思います。</p><h2 id=photogrammetryとは>Photogrammetryとは</h2><p>Wikipediaで調べてみると、『<a href=https://ja.wikipedia.org/wiki/%E5%86%99%E7%9C%9F%E6%B8%AC%E9%87%8F%E6%B3%95>写真測量法 (しゃしんそくりょうほう 英: Photogrammetry) とは、写真画像から対象物の幾何学特性を得る方法である。</a>』と出てきます。<br>そこで、他にもGoogle検索してみると、<br><a href="https://old2-lecture.nakayasu.com/index_p=3568.html">&ldquo;https://old2-lecture.nakayasu.com/&ldquo;のPhotogrammetry入門</a>には、下記のように記載されており、地形測量技術として古くからある技術だということがわかりました&mldr;</p><blockquote><p>写真測量法（Photogrammetry）の歴史</p><p>写真測量法＝Photogrammetryは、写真画像から対象物の幾何学特性を得る手法であり、歴史的には地形測量技術として発展してきた。ある地点の位置や地点間の距離を測定することは、人間の経済活動の根幹を支える基盤技術であり、その歴史は古代エジプトのピラミッド建設まで遡る。写真測量の歴史も古く写真技術の登場と同じ19世紀に遡る。航空写真から地図を作成する技術は軍事目的としても重要視されていた。その後、人工衛星を利用したGPS（Global Positioning Satellite）測量、衛星写真等や地図を統合したGoogle Mapが登場するなど、地球規模の測量システムは進化し続けている。ここで紹介している物体の三次元形状を測定するスキャニング技術として位置付けられているPhotogrammetryは地形の測量技術の進化形の一つである。</p></blockquote><h1 id=multi-view-environment>Multi-View Environment</h1><p>今回試してみるPhotogrammetryのOSSであるMulti-View Environmentは<a href=https://github.com/simonfuhrmann/mve>https://github.com/simonfuhrmann/mve</a>に、<a href=https://github.com/simonfuhrmann/mve/wiki>解説は同リポジトリのWiki</a>にて公開されています。<br>このリポジトリにはDockerfileも登録されていますが、ベースにしているAiplineLinuxが3.10と少々古い状態です。</p><p>また、Qiitaの記事<a href=https://qiita.com/kotauchisunsun/items/93c037de40335bd398ab>「Photogrammetry on Docker ～ サーバ屋さんもXRしたい ～"https://qiita.com/kotauchisunsun/items/93c037de40335bd398ab&rdquo;」</a>には、<a href=https://github.com/kotauchisunsun/alpine-mve>マルチステージビルドを利用したdocker環境</a>を使い3Dデータを生成した例が紹介されています。<br>このDockerfileではrootユーザのまま実行する環境になっていたり、dockerコンテナを特権モードで実行していたりします。</p><p>上記を踏まえて、</p><ul><li>今回AlpineLinuxをできる限り新しいものにする</li><li>&ndash;privilegedオプションを指定せずに実行できるようにする</li><li>また、docker composeを使うことでマウント指定をコマンドラインで指定せずとも実行できるようにする
改造を織り込んだものを利用します。</li></ul><p>なお、これらの改造を織り込んだソースファイルは<a href=https://github.com/aktnk/mve>https://github.com/aktnk/mve</a>に公開しています。</p><h2 id=写真の準備>写真の準備</h2><p>何か身の回りものを写真撮影し、MVEで処理してみようと思います。<br>そこで、建物の横に植えられている木々の周りで90枚前後iPhoneで撮影しました。<br><figure><a href=/images/multi_view_env/iphone_photos.png><img src=/images/multi_view_env/iphone_photos.png></a><figcaption><h4>用意した写真</h4></figcaption></figure></p><h2 id=reconstrction-pipelineの実行>Reconstrction Pipelineの実行</h2><ul><li>ソースファイルの取得とディレクトリの権限変更<pre tabindex=0><code>$ git clone https://github.com/aktnk/mve.git
$ cd mve
$ chmod -R 777 data
</code></pre></li><li>写真データのコピー<pre tabindex=0><code>$ copy (撮影した写真path名/*.jpg) ./data/image/
</code></pre></li><li>コンテナのビルドと起動<pre tabindex=0><code>$ docker compose up -d --build
</code></pre></li><li>3Dデータ生成<pre tabindex=0><code>$ docker compose exec mve ./reconst_pipe.sh
</code></pre></li></ul><p>なお、上記を実行したところ、途中でファイルがないとエラー終了してしまいました。そこで、もう一度同じ<code>docker compose exec mve ./reconst_pipe.sh</code>を実行したところ、エラーにならず処理が終了しました。2時間程度掛かりました。何故だろう…？</p><h2 id=生成された3dデータの確認>生成された3Dデータの確認</h2><p>今回は、PLYファイルを表示可能なMeshLabのWindows版を起動し、data/scene/surface-L2-clean.plyを[File]>[Import Mesh&mldr;]からインポートすると、下記のように表示されました。<br><figure><a href=/images/multi_view_env/result_ply.png><img src=/images/multi_view_env/result_ply.png></a><figcaption><h4>生成された3Dデータ</h4></figcaption></figure></p><ul><li>写真に写った木々が、再構成された3次元で配置されており、ちょっとビックリ！</li><li>もちろんマウスでグリグリでき、上からも下から&mldr;視点を変えて見ることができます。</li><li>全てが綺麗に再現されている訳ではなく、データがない部分もあるようです。</li></ul><h2 id=他にも写真を取り実行してみた>他にも写真を取り実行してみた&mldr;</h2><p>上記で気をよくして、他にも撮って処理してみました。処理は最後まで終わりましたが、いずれも見たかった物体が表示されませんでした。</p><ul><li>マイカーの周りで撮影した30枚の写真</li><li>建物ものの入り口で撮影した50枚の写真</li></ul><p>何故だろう…？</p></div></div><div id=post-footer class="post-footer main-content-wrap"><div class=post-footer-tags><span class="text-color-light text-small">タグ</span><br><a class="tag tag--primary tag--small" href=/tags/multi-view-environment/>Multi-View Environment</a>
<a class="tag tag--primary tag--small" href=/tags/photogrammetry/>Photogrammetry</a>
<a class="tag tag--primary tag--small" href=/tags/docker/>Docker</a></div><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--disabled"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">次</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2023/01/06/influxdb_from_adv/ data-tooltip="Inkbird BLE通信のアドバタイズデータで取得失敗を無くす" aria-label="前: Inkbird BLE通信のアドバタイズデータで取得失敗を無くす"><span class="hide-xs hide-sm text-small icon-mr">前</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label=この記事を共有する><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://aktnk.github.io/2023/06/04/multi-view-env/" title=Facebookで共有 aria-label=Facebookで共有><i class="fab fa-facebook-square" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://aktnk.github.io/2023/06/04/multi-view-env/" title=Twitterで共有 aria-label=Twitterで共有><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://aktnk.github.io/2023/06/04/multi-view-env/" title=Linkedinで共有 aria-label=Linkedinで共有><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label=トップに戻る><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div></div></article><footer id=footer class=main-content-wrap><span class=copyrights>&copy; 2023 Aktnk Lab. All Rights Reserved</span></footer></div><div id=bottom-bar class=post-bottom-bar data-behavior=4><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--disabled"><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">次</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2023/01/06/influxdb_from_adv/ data-tooltip="Inkbird BLE通信のアドバタイズデータで取得失敗を無くす" aria-label="前: Inkbird BLE通信のアドバタイズデータで取得失敗を無くす"><span class="hide-xs hide-sm text-small icon-mr">前</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label=この記事を共有する><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://aktnk.github.io/2023/06/04/multi-view-env/" title=Facebookで共有 aria-label=Facebookで共有><i class="fab fa-facebook-square" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://aktnk.github.io/2023/06/04/multi-view-env/" title=Twitterで共有 aria-label=Twitterで共有><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://aktnk.github.io/2023/06/04/multi-view-env/" title=Linkedinで共有 aria-label=Linkedinで共有><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label=トップに戻る><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div></div><div id=share-options-bar class=share-options-bar data-behavior=4><i id=btn-close-shareoptions class="fa fa-times"></i><ul class=share-options><li class=share-option><a class=share-option-btn target=new href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Faktnk.github.io%2F2023%2F06%2F04%2Fmulti-view-env%2F" aria-label=Facebookで共有><i class="fab fa-facebook-square" aria-hidden=true></i><span>Facebookで共有</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://twitter.com/intent/tweet?text=https%3A%2F%2Faktnk.github.io%2F2023%2F06%2F04%2Fmulti-view-env%2F" aria-label=Twitterで共有><i class="fab fa-twitter" aria-hidden=true></i><span>Twitterで共有</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Faktnk.github.io%2F2023%2F06%2F04%2Fmulti-view-env%2F" aria-label=Linkedinで共有><i class="fab fa-linkedin" aria-hidden=true></i><span>Linkedinで共有</span></a></li></ul></div><div id=share-options-mask class=share-options-mask></div></div><div id=about><div id=about-card><div id=about-btn-close><i class="fa fa-times"></i></div><img id=about-card-picture src="https://avatars.githubusercontent.com/u/13390370?v=4" alt=プロフィール画像><h4 id=about-card-name></h4><div id=about-card-bio>Aktnk Lab is my personal blog.</div><div id=about-card-job><i class="fa fa-briefcase"></i><br>in-house system engineer</div><div id=about-card-location><i class="fa fa-map-marker-alt"></i><br>Shizuoka pref. in Japan</div></div></div><div id=cover style=background-image:url(https://aktnk.github.io/images/metro_filt.jpg)></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://aktnk.github.io/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js></script>
<script>$(document).ready(function(){hljs.configure({classPrefix:'',useBR:!1}),$("pre.code-highlight > code, pre > code").each(function(t,e){$(this).hasClass("codeblock")||$(this).addClass("codeblock"),hljs.highlightBlock(e)})})</script></body></html>